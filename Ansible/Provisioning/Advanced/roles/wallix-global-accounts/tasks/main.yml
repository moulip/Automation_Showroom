---
# Main task file for WALLIX Global Domain Accounts management

- name: Display global accounts management start
  debug:
    msg:
      - "Starting WALLIX global domain accounts management"
      - "Mode: {{ wallix_global_accounts_mode }}"
      - "Global accounts to manage: {{ wallix_global_accounts | length }}"
      - "Global domains to manage: {{ wallix_global_domains | length }}"

# Include global domain management tasks
- name: Include global domain management tasks
  include_tasks: manage_global_domains.yml
  when: 
    - wallix_global_domains is defined
    - wallix_global_domains | length > 0
    - wallix_global_accounts_mode != 'dry_run'

# Include global account creation tasks
- name: Include global account creation tasks
  include_tasks: create_global_accounts.yml
  when: 
    - wallix_global_accounts is defined
    - wallix_global_accounts | length > 0

# Include global account credentials management
- name: Include global account credentials tasks
  include_tasks: manage_credentials.yml
  when: 
    - wallix_global_accounts is defined
    - wallix_global_accounts | length > 0
    - wallix_global_accounts_mode != 'dry_run'

# Display completion summary
- name: Display global accounts management summary
  debug:
    msg:
      - "Global domain accounts management completed"
      - "Mode: {{ wallix_global_accounts_mode }}"
      - "Status: {{ wallix_global_accounts_status | default('success') }}"
      - "Global accounts processed: {{ wallix_global_accounts_created | default(0) }}"
      - "Global domains processed: {{ wallix_global_domains_created | default(0) }}"