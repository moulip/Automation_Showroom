---
# WALLIX Domains Role - Main Tasks
# Manages authentication domains and global domains for WALLIX Bastion

- name: "Domains | Validate domain parameters"
  include_tasks: validate_domains.yml
  when: wallix_domains.validate_before_apply | default(true)
  tags:
    - domains
    - validate

- name: "Domains | Manage authentication domains"
  include_tasks: auth_domains.yml
  when: wallix_domains.manage_auth_domains | default(true)
  tags:
    - domains
    - auth_domains

- name: "Domains | Manage LDAP domains"
  include_tasks: ldap_domains.yml
  when: 
    - wallix_domains.manage_ldap_domains | default(true)
    - wallix_auth_domains.external_domains | selectattr('type', 'equalto', 'ldap') | list | length > 0
  tags:
    - domains
    - ldap

- name: "Domains | Manage Active Directory domains"
  include_tasks: ad_domains.yml
  when: 
    - wallix_domains.manage_ad_domains | default(true)
    - wallix_auth_domains.external_domains | selectattr('type', 'equalto', 'ad') | list | length > 0
  tags:
    - domains
    - ad

- name: "Domains | Manage RADIUS domains"
  include_tasks: radius_domains.yml
  when: 
    - wallix_domains.manage_radius_domains | default(true)
    - wallix_auth_domains.external_domains | selectattr('type', 'equalto', 'radius') | list | length > 0
  tags:
    - domains
    - radius

- name: "Domains | Manage global domains"
  include_tasks: global_domains.yml
  when: wallix_domains.manage_global_domains | default(true)
  tags:
    - domains
    - global_domains

- name: "Domains | Test domain connectivity"
  include_tasks: test_domains.yml
  when: wallix_domains_debug.test_connections | default(true)
  tags:
    - domains
    - test

- name: "Domains | Generate domains report"
  include_tasks: generate_report.yml
  when: wallix_domains.detailed_logging | default(true)
  tags:
    - domains
    - report